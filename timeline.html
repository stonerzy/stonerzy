<!DOCTYPE html>
<html style="height: 100%">

<head>
    <meta charset="utf-8">
</head>

<body style="height: 100%; margin: 0">
    <div id="container" style="height: 100%"></div>

    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/echarts@5/dist/echarts.min.js"></script>
    <script type="text/javascript">
        var dom = document.getElementById("container");
        var myChart = echarts.init(dom);
        var app = {};

        var option;
        let ori_data = [{
                id: 0,
                name: '培根',
                startTime: '1561-01-22',
                endTime: '1626-04-09',
                remark: '',
            }, {
                id: 1,
                name: '霍布斯',
                startTime: '1588-04-05',
                endTime: '1679-12-04',
                remark: '',
                events: [{
                    time: '1651',
                    remark: '《利维坦》出版'
                }]
            }, {
                id: 2,
                name: '笛卡尔',
                startTime: '1596-03-31',
                endTime: '1650-02-11',
                remark: '',
            }, {
                id: 3,
                name: '洛克',
                startTime: '1632-08-29',
                endTime: '1704-10-28',
                remark: '',
                events: [{
                    time: '1687',
                    remark: '《人类理智论》出版'
                }]
            }, {
                id: 4,
                name: '斯宾诺莎',
                startTime: '1632-11-24',
                endTime: '1677-02-21',
                remark: '24岁退出犹太教会，32岁隐居、磨镜片',
            }, {
                id: 5,
                name: '莱布尼茨',
                startTime: '1646-07-01',
                endTime: '1716-11-14',
                events: [{
                    time: '1707',
                    remark: '《人类理智新论》出版'
                }, {
                    time: '1714',
                    remark: '《单子论》出版'
                }]
            }, {
                id: 6,
                name: '贝克莱',
                startTime: '1685-03-12',
                endTime: '1753-01-14',
                events: [{
                    time: '1710',
                    remark: '《论人类知识原理》出版'
                }]
            }, {
                id: 7,
                name: '休谟',
                startTime: '1711-04-26',
                endTime: '1776-08-25',
                events: [{
                    time: '1737',
                    remark: '《人性论》出版'
                }]
            }, {
                id: 8,
                name: '康德',
                startTime: '1724-04-22',
                endTime: '1804-02-12',
                events: [{
                    time: '1781',
                    remark: '《纯粹理性批判》'
                }, {
                    time: '1788',
                    remark: '《实践理性批判》'
                }, {
                    time: '1790',
                    remark: '《判断力批判》'
                }]
            }, {
                id: 9,
                name: '黑格尔',
                startTime: '1770-08-27',
                endTime: '1831-11-14',
                events: []
            }, {
                id: 10,
                name: '谢林',
                startTime: '1775-01-27',
                endTime: '1854-08-20',
                events: []
            }, {
                id: 11,
                name: '叔本华',
                startTime: '1788-02-22',
                endTime: '1860-09-21',
                events: []
            }, {
                id: 12,
                name: '波德莱尔',
                startTime: '1821-04-09',
                endTime: '1867-08-31',
                events: []
            }, {
                id: 13,
                name: '尼采',
                startTime: '1844-10-15',
                endTime: '1900-08-25',
                events: []
            }, {
                id: 14,
                name: '兰波',
                startTime: '1854-10-20',
                endTime: '1891-11-10',
                events: []
            }, {
                id: 15,
                name: '布莱克',
                startTime: '1757-11-28',
                endTime: '1827-08-12',
                events: []
            }, {
                id: 16,
                name: '叶芝',
                startTime: '1865-06-13',
                endTime: '1939-01-28',
                events: []
            }, {
                id: 17,
                name: '莫奈',
                startTime: '1840-11-14',
                endTime: '1926-12-05',
                events: []
            }, {
                id: 18,
                name: '塞尚',
                startTime: '1839-01-19',
                endTime: '1906-10-22',
                events: []
            }, {
                id: 19,
                name: '马奈',
                startTime: '1832-01-23',
                endTime: '1883-04-30',
                events: []
            }, {
                id: 20,
                name: '杜尚',
                startTime: '1887-07-28',
                endTime: '1968-10-02',
                events: []
            }, {
                id: 21,
                name: '胡塞尔',
                startTime: '1859-04-08',
                endTime: '1938-04-27',
                events: []
            }, , {
                id: 22,
                name: '维特根斯坦',
                startTime: '1889-04-26',
                endTime: '1951-04-29',
                events: []
            }, {
                id: 23,
                name: '海德格尔',
                startTime: '1889-09-26',
                endTime: '1976-05-26',
                events: []
            }, {
                id: 24,
                name: '伏尔泰',
                startTime: '1694-11-21',
                endTime: '1778-05-30',
                events: []
            }, {
                id: 25,
                name: '拉辛',
                startTime: '1639-12-22',
                endTime: '1699-04-21',
                events: []
            }, {
                id: 26,
                name: '卢梭',
                startTime: '1712-06-28',
                endTime: '1778-07-02',
                events: []
            }, {
                id: 27,
                name: '狄德罗',
                startTime: '1713-10-05',
                endTime: '1784-07-31',
                events: []
            }, {
                id: 28,
                name: '伯克',
                startTime: '1729-01-12',
                endTime: '1797-07-09',
                events: []
            }, {
                id: 29,
                name: '夏夫兹博里',
                startTime: '1671-01-01',
                endTime: '1713-01-01',
                events: []
            }, {
                id: 30,
                name: '歌德',
                startTime: '1749-08-28',
                endTime: '1832-03-22',
                events: []
            }, {
                id: 31,
                name: '诺瓦利斯',
                startTime: '1772-05-02',
                endTime: '1801-03-25',
                events: []
            }, {
                id: 32,
                name: '荷尔德林',
                startTime: '1770-03-20',
                endTime: '1843-06-07',
                events: []
            }, {
                id: 33,
                name: '席勒',
                startTime: '1759-11-10',
                endTime: '1805-05-09',
                events: []
            }, {
                id: 34,
                name: '鲍姆加登',
                startTime: '1714-07-17',
                endTime: '1762-05-27',
                events: []
            }, {
                id: 35,
                name: '温科尔曼',
                startTime: '1717-12-09',
                endTime: '1768-06-08',
                events: []
            }

        ]




        var data = [];
        ori_data.forEach(item => {
            if (item.startTime == undefined) {
                data.push({
                    value: [item.id, new Date(item.time).getTime(), null, null, item.remark, 1]
                })
            } else {
                data.push({
                    value: [item.id, new Date(item.startTime).getTime(), new Date(item.endTime).getTime(), item.name, item.remark, 0]
                })
                if (item.events != undefined) {
                    item.events.forEach(ele => {
                        data.push({
                            value: [item.id + 0.1, new Date(ele.time).getTime(), null, null, ele.remark, 1]
                        })
                    })
                }
            }
        })
        console.log(data)


        function renderItem(params, api) {
            console.log(api.value(5))
                //console.log(params, api.value(0), api.value(1), api.value(2))
            var categoryIndex = api.value(0);
            var start = api.coord([api.value(1), categoryIndex]);
            var end, barLength, name, nameWidth, text, rectNormal, rectText
            var barHeight = api.size([0, 1])[1] * 0.05;
            if (api.value(5) === 1) {
                rectNormal = clipRectByRect(params, {
                    x: start[0],
                    y: start[1] - barHeight / 2,
                    width: 7,
                    height: 7
                });
                return {
                    type: 'rect',
                    transition: ['shape'],
                    shape: rectNormal,
                    style: api.style({
                        fill: 'red'
                    })
                }
            } else {
                end = api.coord([api.value(2), categoryIndex])
                barLength = end[0] - start[0]
                name = api.value(3) + '';
                nameWidth = echarts.format.getTextRect(name).width;
                text = (barLength > nameWidth + 40 && start[0] + barLength >= 180) ? name : '';
                rectNormal = clipRectByRect(params, {
                    x: start[0],
                    y: start[1] - barHeight / 2,
                    width: end[0] - start[0],
                    height: barHeight + 1
                });
                rectText = clipRectByRect(params, {
                    x: barLength + start[0],
                    y: start[1] - barHeight / 2,
                    width: nameWidth,
                    height: 30
                });
                return {
                    type: 'group',
                    children: [{
                        type: 'rect',
                        transition: ['shape'],
                        shape: rectNormal,
                        style: api.style()
                    }, {
                        type: 'rect',
                        ignore: !rectText,
                        shape: rectText,
                        style: api.style({
                            fill: 'transparent',
                            stroke: 'transparent',
                            text: text,
                            textAlign: 'right',
                            textFill: 'black'
                        })
                    }]
                }
            }
        }

        function clipRectByRect(params, rect) {
            return echarts.graphic.clipRectByRect(rect, {
                x: params.coordSys.x,
                y: params.coordSys.y,
                width: params.coordSys.width,
                height: params.coordSys.height
            });
        }
        option = {
            tooltip: {
                formatter: function(params) {
                    return params.value[3] + ': ' + (params.value[4] || '');
                }
            },
            dataZoom: [{
                type: 'slider',
                xAxisIndex: 0,
                filterMode: 'weakFilter',
                height: 15,
                top: 20,
                start: 0,
                end: 100,
                handleIcon: 'path://M10.7,11.9H9.3c-4.9,0.3-8.8,4.4-8.8,9.4c0,5,3.9,9.1,8.8,9.4h1.3c4.9-0.3,8.8-4.4,8.8-9.4C19.5,16.3,15.6,12.2,10.7,11.9z M13.3,24.4H6.7V23h6.6V24.4z M13.3,19.6H6.7v-1.4h6.6V19.6z',
                handleSize: '80%',
                showDetail: false
            }, {
                type: 'inside',
                id: 'insideX',
                xAxisIndex: 0,
                filterMode: 'weakFilter',
                start: 0,
                end: 100,
                zoomOnMouseWheel: false,
                moveOnMouseMove: true
            }, {
                type: 'slider',
                yAxisIndex: 0,
                zoomLock: true,
                width: 10,
                right: 10,
                top: 70,
                bottom: 20,
                start: 20,
                end: 100,
                handleSize: 0,
                showDetail: false,
            }, {
                type: 'inside',
                id: 'insideY',
                yAxisIndex: 0,
                start: -1,
                end: 100,
                zoomOnMouseWheel: false,
                moveOnMouseMove: true,
                moveOnMouseWheel: true
            }],
            grid: {
                height: '100%'
            },
            xAxis: {
                axisLine: {
                    show: false
                },
                axisTick: {
                    show: false
                },
                position: 'top',
                scale: true,
                splitLine: {
                    show: true,
                    lineStyle: {
                        color: ['#E9EDFF']
                    }
                },
                axisLabel: {
                    formatter: function(val) {
                        console.log(val)
                        return new Date(val).toISOString().substring(0, 4)
                    }
                },
            },
            yAxis: {
                type: 'value',
                show: false,
                min: -5,
                max: ori_data[ori_data.length - 1].id + 1
            },
            series: [{
                type: 'custom',
                renderItem: renderItem,
                itemStyle: {
                    opacity: 0.8
                },
                encode: {
                    x: [1, 2],
                    y: 0
                },
                data: data
            }]
        };

        if (option && typeof option === 'object') {
            myChart.setOption(option);
        }
    </script>
</body>

</html>